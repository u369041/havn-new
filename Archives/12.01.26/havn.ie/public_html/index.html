<!DOCTYPE html>
<!-- HAVN HOME v6 — Ultra Thin Hero + Search + Premium Cards — LOCKED (Jan 2026) -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>havn.ie — Ireland’s curated property marketplace</title>
  <meta name="description" content="Curated listings with real detail — and a cleaner buying experience in Ireland." />

  <meta property="og:title" content="havn.ie — Curated property listings in Ireland" />
  <meta property="og:description" content="Search better. Browse smarter. Curated listings with real detail." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://havn.ie/" />
  <meta property="og:image" content="https://havn.ie/og.png" />

  <style>
    :root{
      --bg:#f6f7fb;
      --text:#0b1220;
      --muted:#5d6b85;
      --line:rgba(15,23,42,0.10);
      --shadow:0 16px 40px rgba(15,23,42,0.12);
      --shadow2:0 8px 22px rgba(15,23,42,0.07);
      --radius2:22px;
      --accent:#2563eb;
      --accent2:#0ea5e9;
      --chip:#eef2ff;
      --chipText:#273a9b;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(37,99,235,0.06), transparent 55%),
        radial-gradient(900px 500px at 80% -10%, rgba(14,165,233,0.08), transparent 50%),
        var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      letter-spacing:-0.01em;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:24px 18px 80px;}

    .nav{
      display:flex;align-items:center;justify-content:space-between;gap:18px;
      padding:14px 16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.78);
      backdrop-filter: blur(10px);
      border-radius: var(--radius2);
      box-shadow: var(--shadow2);
      position: sticky; top:12px; z-index:50;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:160px;}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background: linear-gradient(135deg, rgba(37,99,235,0.95), rgba(14,165,233,0.95));
      box-shadow: 0 12px 28px rgba(37,99,235,0.18);
      position:relative;
      flex:0 0 auto;
    }
    .logo:before{
      content:""; position:absolute; inset:9px 10px 10px 10px;
      border:2px solid rgba(255,255,255,0.92);
      border-bottom-left-radius:7px;border-bottom-right-radius:7px;
      border-top-left-radius:3px;border-top-right-radius:3px;
      transform: skewY(-2deg);
    }
    .brand .name{font-weight:900;font-size:18px;line-height:1}
    .brand .tag{font-size:12px;color:var(--muted);margin-top:2px}

    .navlinks{display:flex;gap:16px;align-items:center;flex:1;justify-content:center;}
    .navlinks a{
      text-decoration:none;color:var(--muted);
      font-weight:750;font-size:14px;padding:8px 10px;border-radius:12px;
      transition: all .15s ease;
    }
    .navlinks a:hover{color:var(--text);background:rgba(15,23,42,0.05)}

    .navactions{display:flex;gap:10px;align-items:center;}
    .btn{
      border:1px solid var(--line);
      background:#fff;color:var(--text);
      border-radius:14px;padding:10px 12px;
      font-weight:800;font-size:14px;cursor:pointer;
      transition:all .15s ease;
      box-shadow: 0 1px 0 rgba(15,23,42,0.04);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:var(--shadow2);}
    .btn.primary{
      background:linear-gradient(135deg, rgba(11,18,32,0.96), rgba(17,24,39,0.96));
      color:#fff;border-color:rgba(255,255,255,0.12);
      box-shadow: 0 10px 25px rgba(11,18,32,0.20);
    }

    .heroRow{margin-top:10px;display:flex;justify-content:center;}
    .heroCard{
      width:100%;
      max-width:980px;
      border:1px solid rgba(15,23,42,0.08);
      background:rgba(255,255,255,0.74);
      backdrop-filter: blur(10px);
      border-radius: var(--radius2);
      box-shadow: var(--shadow2);
      padding:8px 14px 6px;
      position:relative;
      overflow:hidden;
    }
    .heroCard:after{
      content:"";
      position:absolute;
      right:-240px; top:-320px;
      width:720px;height:720px;
      background: radial-gradient(circle at 35% 35%, rgba(37,99,235,0.08), transparent 62%);
      pointer-events:none;
    }

    .heroLine{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }

    .heroTitle{
      font-size:20px;
      font-weight:950;
      letter-spacing:-0.03em;
      margin:0;
      line-height:1.05;
      white-space:nowrap;
    }
    .heroSub{
      font-size:12px;
      color:var(--muted);
      margin:0;
      line-height:1.25;
      max-width:70ch;
      flex:1;
      min-width:280px;
    }

    .trust{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .trustPill{
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px 8px;
      border:1px solid rgba(15,23,42,0.10);
      background:rgba(255,255,255,0.82);
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      color:var(--text);
      white-space:nowrap;
    }
    .trustIcon{
      width:18px;height:18px;
      border-radius:7px;
      background:rgba(37,99,235,0.10);
      border:1px solid rgba(37,99,235,0.14);
      display:flex;align-items:center;justify-content:center;
      font-weight:950;color:#1d4ed8;font-size:10px;
      flex:0 0 auto;
    }

    .searchShell{margin-top:10px;display:flex;justify-content:center;}
    .searchCard{
      width:100%;
      max-width:980px;
      border:1px solid rgba(37,99,235,0.18);
      background:rgba(255,255,255,0.96);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .searchCard:before{
      content:"";
      position:absolute;
      left:-160px; bottom:-220px;
      width:460px;height:460px;
      background: radial-gradient(circle at 60% 40%, rgba(14,165,233,0.18), transparent 62%);
      pointer-events:none;
    }

    .tabs{
      display:inline-flex;
      padding:6px;
      border-radius:18px;
      background:rgba(15,23,42,0.04);
      border:1px solid rgba(15,23,42,0.06);
      gap:6px;
    }
    .tab{
      border:0;background:transparent;
      padding:10px 14px;border-radius:14px;
      font-weight:950;color:var(--muted);
      cursor:pointer;font-size:13px;
      transition: all .15s ease;
    }
    .tab.active{
      background:#fff;color:var(--text);
      box-shadow: 0 1px 0 rgba(15,23,42,0.06);
      border:1px solid rgba(15,23,42,0.08);
    }

    .searchGrid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.6fr 1fr 1fr 0.9fr;
      gap:12px;
      align-items:end;
    }
    .searchGrid2{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 0.9fr;
      gap:12px;
      align-items:end;
    }

    .field label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
      font-weight:850;
    }
    .input, .select{
      width:100%;
      border:1px solid rgba(15,23,42,0.10);
      border-radius:16px;
      padding:14px 14px;
      outline:none;
      font-size:14px;
      background:#fff;
      transition: all .15s ease;
    }
    .input:focus, .select:focus{
      border-color: rgba(37,99,235,0.35);
      box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
    }
    .searchBtn{
      width:100%;
      border:0;border-radius:18px;
      padding:15px 16px;
      font-weight:950;cursor:pointer;font-size:14px;color:#fff;
      background: linear-gradient(135deg, rgba(37,99,235,0.98), rgba(14,165,233,0.98));
      box-shadow: 0 12px 30px rgba(37,99,235,0.22);
      transition: all .15s ease;
    }
    .searchBtn:hover{transform:translateY(-1px); box-shadow:0 14px 36px rgba(37,99,235,0.28);}

    .sectionHead{
      margin-top:22px;
      display:flex;
      align-items:end;
      justify-content:space-between;
      gap:12px;
    }
    .sectionHead h2{
      margin:0;
      font-size:18px;
      letter-spacing:-0.02em;
      font-weight:950;
    }
    .sectionHead p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
    }

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:14px;
    }

    .card{
      border:1px solid rgba(15,23,42,0.10);
      background:rgba(255,255,255,0.92);
      border-radius: var(--radius2);
      box-shadow: var(--shadow2);
      overflow:hidden;
      transition: transform .15s ease, box-shadow .15s ease;
      cursor:pointer;
      text-decoration:none;
      color:inherit;
      display:block;
    }
    .card:hover{transform:translateY(-3px); box-shadow: var(--shadow);}

    .thumb{height:150px; background:#e5e7eb; position:relative; overflow:hidden;}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}

    .corner{position:absolute; top:10px; left:10px; display:flex; gap:6px;}
    .tagChip{
      font-size:11px;
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(11,18,32,0.80);
      color:#fff;
      border:1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(10px);
    }
    .tagChip.light{
      background: rgba(255,255,255,0.78);
      color: var(--text);
      border-color: rgba(15,23,42,0.10);
    }

    .body{padding:12px 12px 14px; display:flex; flex-direction:column; gap:8px;}
    .price{font-weight:950; font-size:16px; letter-spacing:-0.02em;}

    .titleRow{display:flex; gap:10px; justify-content:space-between; align-items:flex-start;}
    .title{
      font-weight:950;
      font-size:14px;
      line-height:1.2;
      max-height:2.4em;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }
    .eircode{
      font-size:11px;
      color:var(--muted);
      border:1px solid rgba(15,23,42,0.10);
      padding:4px 8px;
      border-radius:999px;
      white-space:nowrap;
      margin-top:2px;
      background:rgba(255,255,255,0.85);
    }

    .loc{font-size:12px; color:var(--muted); display:flex; align-items:center; gap:8px;}
    .pin{width:8px;height:8px;border-radius:999px;background:rgba(14,165,233,0.9); box-shadow:0 0 0 4px rgba(14,165,233,0.10);}

    .meta{display:flex; gap:8px; flex-wrap:wrap; margin-top:2px;}
    .chip{
      padding:6px 9px;
      border-radius:999px;
      background: rgba(15,23,42,0.04);
      border:1px solid rgba(15,23,42,0.08);
      font-size:12px;
      font-weight:900;
      color: var(--muted);
    }
    .chip.type{background: var(--chip); border-color: rgba(39,58,155,0.12); color: var(--chipText);}

    .mutedBox{
      margin-top:12px;
      border:1px dashed rgba(15,23,42,0.18);
      background:rgba(255,255,255,0.6);
      border-radius:16px;
      padding:14px 14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .debug{
      position:fixed;
      left:10px;
      bottom:10px;
      z-index:9999;
      font-size:12px;
      color:rgba(11,18,32,0.85);
      background:rgba(255,255,255,0.80);
      border:1px solid rgba(15,23,42,0.12);
      border-radius:12px;
      padding:8px 10px;
      box-shadow: var(--shadow2);
      display:none;
      max-width:min(520px, calc(100vw - 20px));
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .debug strong{color:rgba(11,18,32,0.95); font-weight:900;}
    .debug a{color:rgba(37,99,235,0.95); text-decoration:none; font-weight:900;}
    .debug a:hover{text-decoration:underline;}

    @media (max-width: 980px){
      .navlinks{display:none;}
      .searchGrid,.searchGrid2{grid-template-columns:1fr 1fr;}
      .grid{grid-template-columns: repeat(2, minmax(0,1fr));}
      .heroSub{min-width:unset;}
    }
    @media (max-width: 620px){
      .brand .tag{display:none;}
      .searchGrid,.searchGrid2{grid-template-columns:1fr;}
      .grid{grid-template-columns: 1fr;}
      .heroLine{flex-direction:column; align-items:flex-start;}
      .heroSub{display:none;}
      .trustPill{width:100%; justify-content:flex-start;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="name">havn.ie</div>
          <div class="tag">Ireland’s most curated property marketplace.</div>
        </div>
      </div>

      <nav class="navlinks" aria-label="Primary">
        <a href="#" data-mode="buy">Buy</a>
        <a href="#" data-mode="rent">Rent</a>
        <a href="#" data-mode="share">Share</a>
        <a href="#" data-mode="sell">Sell</a>
        <a href="#" data-mode="agents">Agents</a>
      </nav>

      <div class="navactions">
        <a class="btn primary" href="properties.html">Browse listings</a>
        <a class="btn" href="login.html">Login</a>
      </div>
    </header>

    <section class="heroRow">
      <div class="heroCard">
        <div class="heroLine">
          <p class="heroTitle">Search better. Browse smarter.</p>
          <p class="heroSub">Curated listings with real detail — and a cleaner buying experience in Ireland.</p>
        </div>
        <div class="trust">
          <div class="trustPill"><span class="trustIcon">✓</span> Curated, not cluttered</div>
          <div class="trustPill"><span class="trustIcon">⚡</span> Fast & minimal</div>
          <div class="trustPill"><span class="trustIcon">◎</span> Eircode-first</div>
        </div>
      </div>
    </section>

    <section class="searchShell">
      <div class="searchCard">
        <div class="tabs" role="tablist" aria-label="Search modes">
          <button class="tab active" type="button" data-tab="buy">Buy</button>
          <button class="tab" type="button" data-tab="rent">Rent</button>
          <button class="tab" type="button" data-tab="share">Share</button>
        </div>

        <form id="searchForm" autocomplete="off">
          <div class="searchGrid">
            <div class="field">
              <label for="q">Location</label>
              <input id="q" name="q" class="input" placeholder="Eircode, County, Town, Area…" />
            </div>
            <div class="field">
              <label for="price">Price</label>
              <select id="price" name="price" class="select">
                <option value="">Any</option>
                <option value="under-300k">Under €300k</option>
                <option value="300-500k">€300k – €500k</option>
                <option value="500-800k">€500k – €800k</option>
                <option value="800k-plus">€800k+</option>
              </select>
            </div>
            <div class="field">
              <label for="beds">Beds</label>
              <select id="beds" name="beds" class="select">
                <option value="">Any</option>
                <option value="1">1+</option>
                <option value="2">2+</option>
                <option value="3">3+</option>
                <option value="4">4+</option>
                <option value="5">5+</option>
              </select>
            </div>
            <div class="field">
              <button class="searchBtn" type="submit">Search</button>
            </div>
          </div>

          <div class="searchGrid2">
            <div class="field">
              <label for="type">Property type</label>
              <select id="type" name="type" class="select">
                <option value="">Any</option>
                <option value="HOUSE">House</option>
                <option value="APARTMENT">Apartment</option>
                <option value="SITE">Site</option>
                <option value="COMMERCIAL">Commercial</option>
              </select>
            </div>
            <div class="field">
              <label for="baths">Baths</label>
              <select id="baths" name="baths" class="select">
                <option value="">Any</option>
                <option value="1">1+</option>
                <option value="2">2+</option>
                <option value="3">3+</option>
                <option value="4">4+</option>
              </select>
            </div>
            <div class="field">
              <label for="sort">Sort by</label>
              <select id="sort" name="sort" class="select">
                <option value="newest">Newest</option>
                <option value="price-low">Price (low)</option>
                <option value="price-high">Price (high)</option>
                <option value="beds">Beds</option>
              </select>
            </div>
            <div class="field">
              <button class="btn" type="button" id="advancedBtn" style="width:100%; padding:14px 14px; border-radius:18px;">
                Advanced filters
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <div class="sectionHead">
      <div>
        <h2>Latest Listings</h2>
        <p>Premium compact cards — published listings only.</p>
      </div>
      <a class="btn" href="properties.html">View all</a>
    </div>

    <section class="grid" id="grid"></section>
    <div class="mutedBox" id="emptyState" style="display:none;"></div>
  </div>

  <div class="debug" id="debug"></div>

  <script>
    (function(){
      const API_BASE = "https://api.havn.ie";
      const DEBUG = new URLSearchParams(location.search).has("debug");
      const debugEl = document.getElementById("debug");

      function setDebug(msg){
        if(!DEBUG) return;
        debugEl.style.display = "block";
        debugEl.innerHTML = "<strong>HAVN</strong> " + msg;
      }

      function esc(s){
        return String(s ?? "")
          .replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;")
          .replace(/"/g,"&quot;")
          .replace(/'/g,"&#039;");
      }

      function fmtPrice(n){
        const num = Number(n);
        if(!isFinite(num)) return "";
        try{
          return new Intl.NumberFormat("en-IE", { style:"currency", currency:"EUR", maximumFractionDigits:0 }).format(num);
        }catch(e){
          return "€" + Math.round(num).toLocaleString("en-IE");
        }
      }

      function pickThumb(p){
        const raw = [];
        if (p?.heroImageUrl) raw.push(p.heroImageUrl);
        if (p?.coverImageUrl) raw.push(p.coverImageUrl);
        if (p?.primaryImageUrl) raw.push(p.primaryImageUrl);
        if (p?.imageUrl) raw.push(p.imageUrl);
        if (p?.thumbnailUrl) raw.push(p.thumbnailUrl);

        if (Array.isArray(p?.images) && p.images.length){
          const first = p.images[0];
          if (typeof first === "string") raw.push(first);
          if (first && typeof first === "object" && first.url) raw.push(first.url);
        }

        if (Array.isArray(p?.photos) && p.photos.length){
          const first = p.photos[0];
          if (first?.url) raw.push(first.url);
          if (typeof first === "string") raw.push(first);
        }

        if (Array.isArray(p?.media) && p.media.length){
          const first = p.media[0];
          if (first?.url) raw.push(first.url);
          if (typeof first === "string") raw.push(first);
        }

        if (Array.isArray(p?.cloudinaryImages) && p.cloudinaryImages.length){
          const first = p.cloudinaryImages[0];
          if (typeof first === "string") raw.push(first);
          if (first && typeof first === "object" && first.url) raw.push(first.url);
        }

        const url = raw
          .map(x => (x || "").toString().trim())
          .find(u => u && /^https?:\/\//i.test(u));

        return url || "https://images.unsplash.com/photo-1501183638710-841dd1904471?auto=format&fit=crop&w=1600&q=70";
      }

      function getLocationLine(p){
        return p?.locationText
          || p?.location
          || [p?.town, p?.county].filter(Boolean).join(", ")
          || p?.addressLine
          || "Ireland";
      }

      function getEircode(p){
        return p?.eircode || p?.postalCode || p?.postcode || p?.zip || "";
      }

      function getTitle(p){
        return p?.title || p?.displayTitle || p?.headline || p?.addressLine1 || p?.address || "Property listing";
      }

      // ✅ FIX: strict slug + strict id
      function getSlug(p){
        const slug = (p?.slug || p?.publicSlug || "").toString().trim();
        return slug || "";
      }
      function getId(p){
        const id = (p?.id || p?.propertyId || "").toString().trim();
        return id || "";
      }

      function getType(p){
        const t = (p?.propertyType || p?.type || "").toString();
        return t ? t : "House";
      }

      function getStatusChip(p){
        if(p?.isFeatured || p?.featured) return "Featured";
        if((p?.status || "").toString().toUpperCase() === "NEW") return "New";
        return "New";
      }

      function getBeds(p){
        const v = p?.beds ?? p?.bedrooms ?? p?.numBeds;
        return (v === 0 || v) ? Number(v) : null;
      }

      function getBaths(p){
        const v = p?.baths ?? p?.bathrooms ?? p?.numBaths;
        return (v === 0 || v) ? Number(v) : null;
      }

      // ✅ FIX: link always includes slug OR id
      function makeCard(p){
        const price = fmtPrice(p?.price ?? p?.askingPrice ?? p?.priceEur);
        const title = getTitle(p);
        const loc = getLocationLine(p);
        const eir = getEircode(p);
        const type = getType(p);
        const beds = getBeds(p);
        const baths = getBaths(p);
        const status = getStatusChip(p);
        const thumb = pickThumb(p);

        const slug = getSlug(p);
        const id = getId(p);

        let href = "properties.html";
        if (slug) href = `property.html?slug=${encodeURIComponent(slug)}`;
        else if (id) href = `property.html?id=${encodeURIComponent(id)}`;

        const typeLabel = type ? type.toString().toUpperCase() : "HOUSE";

        return `
          <a class="card" href="${href}">
            <div class="thumb">
              <img loading="lazy" decoding="async" src="${esc(thumb)}" alt="${esc(title)}">
              <div class="corner">
                <span class="tagChip">${esc(status)}</span>
                <span class="tagChip light">${esc(type)}</span>
              </div>
            </div>
            <div class="body">
              <div class="price">${esc(price || "")}</div>
              <div class="titleRow">
                <div class="title">${esc(title)}</div>
                ${eir ? `<div class="eircode">${esc(eir)}</div>` : `<div class="eircode" style="opacity:.0">—</div>`}
              </div>
              <div class="loc"><span class="pin"></span>${esc(loc)}</div>
              <div class="meta">
                ${beds ? `<span class="chip">${beds} bed</span>` : ``}
                ${baths ? `<span class="chip">${baths} bath</span>` : ``}
                <span class="chip type">${esc(typeLabel)}</span>
              </div>
            </div>
          </a>
        `;
      }

      async function fetchJSON(url){
        const res = await fetch(url, { method:"GET", headers: { "Accept":"application/json" }});
        if(!res.ok){
          const text = await res.text().catch(()=> "");
          throw new Error(`HTTP ${res.status} from ${url} :: ${text.slice(0,120)}`);
        }
        return res.json();
      }

      async function loadLatest(){
        const grid = document.getElementById("grid");
        const empty = document.getElementById("emptyState");

        grid.innerHTML = "";
        empty.style.display = "none";
        setDebug(`Loading latest listings…`);

        const tries = [
          `${API_BASE}/api/properties/latest?limit=6`,
          `${API_BASE}/api/properties/latest?take=6`,
          `${API_BASE}/api/properties?status=PUBLISHED&limit=6`,
          `${API_BASE}/api/properties?status=PUBLISHED`,
          `${API_BASE}/api/properties`
        ];

        let json = null;
        let used = null;

        for(const url of tries){
          try{
            json = await fetchJSON(url);
            used = url;
            break;
          }catch(e){
            setDebug(`Latest fetch failed, trying fallback… (${esc(e.message)})`);
          }
        }

        if(!json){
          empty.style.display = "block";
          empty.textContent = "Could not load listings right now. Please try again shortly.";
          setDebug(`Failed to load listings. Check API.`);
          return;
        }

        const items =
          Array.isArray(json) ? json :
          Array.isArray(json?.items) ? json.items :
          Array.isArray(json?.data) ? json.data :
          Array.isArray(json?.results) ? json.results :
          [];

        const published = items.filter(p => {
          const st = (p?.status || p?.state || "").toString().toUpperCase();
          if(!st) return true;
          return st === "PUBLISHED";
        });

        const list = published.slice(0,6);

        if(!list.length){
          empty.style.display = "block";
          empty.textContent = "No published listings yet. Check back soon.";
          setDebug(`Loaded 0 published items from ${used}`);
          return;
        }

        grid.innerHTML = list.map(makeCard).join("");
        setDebug(`Loaded ${list.length} published items from <a href="${used}" target="_blank" rel="noopener">API</a>`);
      }

      function wireTabs(){
        document.querySelectorAll(".tab").forEach(btn => {
          btn.addEventListener("click", () => {
            document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            document.body.dataset.searchMode = btn.dataset.tab || "buy";
          });
        });
        document.body.dataset.searchMode = "buy";
      }

      function wireSearch(){
        const form = document.getElementById("searchForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const fd = new FormData(form);
          const mode = (document.body.dataset.searchMode || "buy");
          const params = new URLSearchParams();
          params.set("mode", mode);

          ["q","price","beds","type","baths","sort"].forEach(k => {
            const v = (fd.get(k) || "").toString().trim();
            if(v) params.set(k, v);
          });

          location.href = `properties.html?${params.toString()}`;
        });

        document.getElementById("advancedBtn").addEventListener("click", () => {
          const fd = new FormData(form);
          const mode = (document.body.dataset.searchMode || "buy");
          const params = new URLSearchParams();
          params.set("mode", mode);
          ["q","price","beds","type","baths","sort"].forEach(k => {
            const v = (fd.get(k) || "").toString().trim();
            if(v) params.set(k, v);
          });
          location.href = `properties.html?${params.toString()}`;
        });
      }

      function wireNavLinks(){
        document.querySelectorAll(".navlinks a[data-mode]").forEach(a => {
          a.addEventListener("click", (e) => {
            e.preventDefault();
            const mode = a.getAttribute("data-mode") || "buy";
            if(mode === "buy" || mode === "rent" || mode === "share"){
              document.querySelectorAll(".tab").forEach(t => {
                t.classList.toggle("active", t.dataset.tab === mode);
              });
              document.body.dataset.searchMode = mode;
              document.querySelector(".searchShell").scrollIntoView({ behavior:"smooth", block:"start" });
            } else {
              location.href = "properties.html";
            }
          });
        });
      }

      wireTabs();
      wireSearch();
      wireNavLinks();
      loadLatest();
    })();
  </script>
</body>
</html>
