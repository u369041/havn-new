// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  admin
  user
}

enum ListingStatus {
  DRAFT
  PUBLISHED
}

model Property {
  id           Int      @id @default(autoincrement())
  slug         String   @unique
  title        String
  address1     String
  address2     String?
  city         String
  county       String
  eircode      String?
  lat          Float?
  lng          Float?
  price        Int
  bedrooms     Int?
  bathrooms    Int?
  propertyType String   @map("propertyType")
  ber          String?
  berNo        String?  @map("berNo")
  saleType     String?  @map("saleType")

  // Previously: status String?
  // Keep your old field, but rename it so we can use listingStatus for draft/published.
  marketStatus String?  @map("status")

  // New: Draft vs Published lifecycle
  listingStatus ListingStatus @default(DRAFT)
  publishedAt   DateTime?

  description  String?
  features     String[] @default([])
  photos       String[] @default([])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  userId Int?
  user   User? @relation(fields: [userId], references: [id])

  @@index([listingStatus])
  @@index([publishedAt])
  @@index([userId])

  @@map("Property")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String?
  email     String   @unique
  password  String
  role      UserRole @default(user)
  createdAt DateTime @default(now())

  properties Property[]
}
