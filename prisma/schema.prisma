// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  admin
  user
}

model Property {
  id           Int      @id @default(autoincrement())
  slug         String   @unique
  title        String
  address1     String
  address2     String?
  city         String
  county       String
  eircode      String?
  lat          Float?
  lng          Float?
  price        Int
  bedrooms     Int?
  bathrooms    Int?
  propertyType String   @map("propertyType")
  ber          String?
  berNo        String?  @map("berNo")
  saleType     String?  @map("saleType")
  marketStatus String?  @map("status")
  description  String?
  features     String[] @default([])
  photos       String[] @default([])

  // Draft/published lifecycle
  listingStatus ListingStatus @default(DRAFT)
  publishedAt   DateTime?

  // âœ… Step 4: revision system
  // If this is a DRAFT revision created from a PUBLISHED listing, this points to the original listing id.
  revisionOfId Int?
  revisionOf   Property? @relation("PropertyRevision", fields: [revisionOfId], references: [id])
  revisions    Property[] @relation("PropertyRevision")

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  userId Int?
  user   User? @relation(fields: [userId], references: [id])

  @@map("Property")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String?
  email     String   @unique
  password  String
  role      UserRole @default(user)
  createdAt DateTime @default(now())

  properties Property[]
}

enum ListingStatus {
  DRAFT
  PUBLISHED
}
