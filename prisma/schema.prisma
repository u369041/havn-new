// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ListingType {
  SALE
  RENT
}

enum ListingStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

/**
 * New: finer-grained “Property Type” for cards & detail (what users see as Semi-D, Detached, etc.)
 */
enum PropertyType {
  DETACHED
  SEMI_D
  TERRACED
  APARTMENT
  BUNGALOW
  DUPLEX
  SITE
  OTHER
}

model Property {
  id            String         @id @default(cuid())
  title         String
  description   String?
  price         Int
  listingType   ListingType
  status        ListingStatus  @default(ACTIVE)

  bedrooms      Int?
  bathrooms     Int?

  // Existing address pieces
  addressLine1  String?
  addressLine2  String?
  city          String?
  county        String?
  eircode       String?        @db.VarChar(12)

  latitude      Float?
  longitude     Float?

  /**
   * New fields:
   *  - propertyType (enum above)
   *  - sizeSqM (m² shown on cards/detail)
   */
  propertyType  PropertyType?  @default(OTHER)
  sizeSqM       Int?           @db.Integer

  // Slug must be unique
  slug          String         @unique

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  images        PropertyImage[]
}

model PropertyImage {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String

  publicId   String?
  url        String
  width      Int?
  height     Int?
  format     String?
  position   Int       @default(0)

  createdAt  DateTime  @default(now())

  @@index([propertyId])
}
