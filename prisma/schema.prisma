generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int        @id @default(autoincrement())
  name                String?
  email               String     @unique
  password            String
  role                UserRole   @default(user)
  createdAt           DateTime   @default(now())
  emailVerified       Boolean    @default(false)
  emailVerifyToken    String?    @unique
  emailVerifyTokenExp DateTime?
  lastLoginAt         DateTime?
  loginCount          Int        @default(0)
  approvals           Property[] @relation("PropertyApprovedBy")
  rejections          Property[] @relation("PropertyRejectedBy")
  properties          Property[]
}

model Property {
  id             Int           @id @default(autoincrement())
  slug           String        @unique
  title          String
  address1       String
  address2       String?
  city           String
  county         String
  eircode        String?
  price          Int
  ber            String?
  bedrooms       Int?
  bathrooms      Int?
  features       String[]
  description    String?
  photos         String[]
  userId         Int
  berNo          String?
  createdAt      DateTime      @default(now())
  lat            Float?
  lng            Float?
  propertyType   String
  saleType       String?
  updatedAt      DateTime      @updatedAt
  listingStatus  ListingStatus @default(DRAFT)
  publishedAt    DateTime?
  archivedAt     DateTime?
  approvedAt     DateTime?
  approvedById   Int?
  rejectedAt     DateTime?
  rejectedById   Int?
  submittedAt    DateTime?
  marketStatus   String?
  rejectedReason String?
  approvedBy     User?         @relation("PropertyApprovedBy", fields: [approvedById], references: [id])
  rejectedBy     User?         @relation("PropertyRejectedBy", fields: [rejectedById], references: [id])
  user           User          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([listingStatus])
}

enum UserRole {
  admin
  user
}

enum ListingStatus {
  DRAFT
  SUBMITTED
  PUBLISHED
  REJECTED
  ARCHIVED
}
