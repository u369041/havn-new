generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  admin
  user
}

enum ListingStatus {
  DRAFT
  SUBMITTED
  PUBLISHED
  REJECTED
  ARCHIVED
}

model User {
  id        Int      @id @default(autoincrement())
  name      String?
  email     String   @unique
  password  String
  role      UserRole @default(user)
  createdAt DateTime @default(now())

  // ✅ Email verification
  emailVerified     Boolean   @default(false)
  emailVerifyToken  String?   @unique
  emailVerifyTokenExp DateTime?

  // ✅ Basic authenticity / account telemetry (future use)
  lastLoginAt DateTime?
  loginCount  Int      @default(0)

  properties Property[]

  approvals  Property[] @relation("PropertyApprovedBy")
  rejections Property[] @relation("PropertyRejectedBy")
}

model Property {
  id              Int           @id @default(autoincrement())
  slug            String        @unique
  title           String
  address1        String
  address2        String?
  city            String
  county          String
  eircode         String?
  price           Int
  ber             String?
  bedrooms        Int?
  bathrooms       Int?
  features        String[]
  description     String?
  photos          String[]
  berNo           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  lat             Float?
  lng             Float?
  propertyType    String
  saleType        String?
  marketStatus    String?

  listingStatus   ListingStatus @default(DRAFT)
  publishedAt     DateTime?
  archivedAt      DateTime?

  submittedAt     DateTime?
  approvedAt      DateTime?
  approvedById    Int?
  approvedBy      User?         @relation("PropertyApprovedBy", fields: [approvedById], references: [id])

  rejectedAt      DateTime?
  rejectedById    Int?
  rejectedBy      User?         @relation("PropertyRejectedBy", fields: [rejectedById], references: [id])
  rejectionReason String?

  userId          Int
  user            User          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([listingStatus])
}
