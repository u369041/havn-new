// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  admin
  user
}

enum ListingStatus {
  DRAFT
  PENDING
  PUBLISHED
  ARCHIVED
}

model Property {
  id           Int      @id @default(autoincrement())
  slug         String   @unique
  title        String
  address1     String
  address2     String?
  city         String
  county       String
  eircode      String?
  lat          Float?
  lng          Float?
  price        Int
  bedrooms     Int?
  bathrooms    Int?
  propertyType String   @map("propertyType")
  ber          String?
  berNo        String?  @map("berNo")
  saleType     String?  @map("saleType")
  marketStatus String?  @map("status")
  description  String?
  features     String[] @default([])
  photos       String[] @default([])

  // lifecycle
  listingStatus ListingStatus @default(DRAFT)
  publishedAt   DateTime?
  archivedAt    DateTime?

  // âœ… Step 6 moderation fields
  submittedAt     DateTime?
  approvedAt      DateTime?
  approvedById    Int?
  approvedBy      User?     @relation("PropertyApprovedBy", fields: [approvedById], references: [id])
  rejectedAt      DateTime?
  rejectedById    Int?
  rejectedBy      User?     @relation("PropertyRejectedBy", fields: [rejectedById], references: [id])
  rejectionReason String?

  // Step 4 revision system
  revisionOfId Int?
  revisionOf   Property?  @relation("PropertyRevision", fields: [revisionOfId], references: [id])
  revisions    Property[] @relation("PropertyRevision")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId Int?
  user   User? @relation(fields: [userId], references: [id])

  @@map("Property")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String?
  email     String   @unique
  password  String
  role      UserRole @default(user)
  createdAt DateTime @default(now())

  properties Property[]

  // moderation relations
  approvals  Property[] @relation("PropertyApprovedBy")
  rejections Property[] @relation("PropertyRejectedBy")
}
